---
name: useSize
menu: Hooks
route: /use-size
---

import {Playground} from 'docz';
import useSize from './src';

# useSize

A React [hook] for components that care about their size.

## Installation

```shell
yarn add @hzcore/hook-size
```

## Usage

```js
import useSize from '@hzcore/hook-size';
```

`useSize` has two different modes of usage: **stateful** and **stateless**.
(See [stateful] and [stateless] for more on why and when to use which).

Additionally, `useSize` supports using an existing [ref object].
(See [shared ref / ref forwarding] for more).

This means `useState` has 4 different signatures:

```ts
// Stateful
function useSize(): [Size, React.RefObject<HTMLElement>];

// Stateful with a provided ref
function useSize(providedRef: React.RefObject<HTMLElement>): Size;

// Stateless with a handler
function useSize(handler: (size: Size) => void): React.RefObject<HTMLElement>;

// Stateless with a handler and a provided ref
function useSize(
  handler: (size: Size) => void,
  providedRef: React.RefObject<HTMLElement>,
): void;
```

## Stateful

Sometimes a component wants to simply update whenever the size changes.
In these cases, `useSize` provides a **stateful** API.

To `useSize` statefully, call `useSize` without any arguments.
It will return an array containing a [Size] state and a [ref object]:

```ts
function useSize(): [Size, React.RefObject<HTMLElement>];
```

The returned [ref object] should be passed to the DOM element to be measured.

### Stateful Example

<Playground>
  {() => {
    const SizeStateUser = () => {
      const [size, ref] = useSize();
      return (
        <div
          ref={ref}
          style={{
            width: '100%',
            height: '100%',
            flex: 1,
            display: 'flex',
            justifyContent: 'center',
            alignItems: 'center',
          }}
        >
          <pre>{JSON.stringify(size, null, 2)}</pre>
        </div>
      );
    };
    return <SizeStateUser />;
  }}
</Playground>

To `useSize` statefully with an existing [ref object], pass it
to `useSize`. It will return _just_ a [Size] state (_not_ an array):

```ts
function useSize(providedRef: React.RefObject<HTMLElement>): Size;
```

The existing `providedRef` [ref object] should be passed to the DOM element
to be measured.

See [Shared Ref / Ref Forwarding] for more on `providedRef`.

### Stateful Example with an Existing Ref

<Playground>
  {() => {
    const SizeStateUser = () => {
      const ref = React.useRef(null);
      const size = useSize(ref);
      return (
        <div
          ref={ref}
          style={{
            width: '100%',
            height: '100%',
            flex: 1,
            display: 'flex',
            justifyContent: 'center',
            alignItems: 'center',
          }}
        >
          <pre>{JSON.stringify(size, null, 2)}</pre>
        </div>
      );
    };
    return <SizeStateUser />;
  }}
</Playground>

## Stateless

Sometimes (often for performance reasons), a component wants to derive state
from size changes, or debounce or otherwise throttle updates caused by changes.
In these cases, `useSize` provides a **stateless** API.

To `useSize` statelessly, call `useSize` with a [handler] function.
It will return a [ref object]:

```ts
function useSize(handler: (size: Size) => void): React.RefObject<HTMLElement>;
```

The returned [ref object] should be passed to the DOM element to be measured.

### Stateless Example

<Playground>
  {() => {
    const SizeUser = () => {
      const [size, setSize] = React.useState(null);
      const ref = useSize(setSize);
      return (
        <div
          ref={ref}
          style={{
            width: '100%',
            height: '100%',
            flex: 1,
            display: 'flex',
            justifyContent: 'center',
            alignItems: 'center',
          }}
        >
          <pre>{JSON.stringify(size, null, 2)}</pre>
        </div>
      );
    };
    return <SizeUser />;
  }}
</Playground>

To `useSize` statelessly with an existing [ref object], call `useSize`
with a [handler] function and the [ref object]. It will return `undefined`:

```ts
function useSize(
  handler: (size: Size) => void,
  providedRef: React.RefObject<HTMLElement>,
): void;
```

The existing `providedRef` [ref object] should be passed to the DOM element
to be measured.

See [Shared Ref / Ref Forwarding] for more on `providedRef`.

### Stateless Example With an Existing Ref

<Playground>
  {() => {
    const SizeUser = () => {
      const [size, setSize] = React.useState(null);
      const ref = React.useRef(null);
      useSize(setSize, ref);
      return (
        <div
          ref={ref}
          style={{
            width: '100%',
            height: '100%',
            flex: 1,
            display: 'flex',
            justifyContent: 'center',
            alignItems: 'center',
          }}
        >
          <pre>{JSON.stringify(size, null, 2)}</pre>
        </div>
      );
    };
    return <SizeUser />;
  }}
</Playground>

## Shared Ref / Ref Forwarding

Sometimes a component needs to [forward a ref] to its children,
or [use a ref][useref] with other hooks.
To support these cases, `useSize` accepts an optional `providedRef` [ref object].

It could be used with ref forwarding like:

```js
const SomeRefForwardingComponent = React.forwardRef((props, forwardedRef) => {
  // We pass `forwardedRef` (which _must_ be a ref object)
  // to `useSize`. Note that a `ref` will _not_ be returned.
  const size = useSize(forwardedRef);
  return <div ref={forwardedRef}>{JSON.stringify(size, null, 2)}</div>;
});
```

or, with `useRef`:

```js
const SomeRefUsingComponent = () => {
  const ref = React.useRef(null);
  // We pass `ref` to `useSize`.
  // Note that a `ref` will _not_ be returned.
  const size = useSize(ref);
  return <div ref={ref}>{JSON.stringify(size, null, 2)}</div>;
};
```

## Handler

`handler: (size: Size) => void,`

A function to handle size updates.
Receives the latest [Size]. This is passed to `useSize` when
a component has a [stateless] use case. For simpler [stateful] use cases,
no handler is necessary.

## Size

The `Size` object is a [DOMRect]-like object with additional
`vw` and `vh` measurements, where `vw` is The [DOMRect] width as a
percentage of the viewport width, and `vh` is The [DOMRect] height
as a percentage of the viewport height.

```ts
interface Size {
  /** The x coordinate of the DOMRect's origin. */
  x: number;
  /** The y coordinate of the DOMRect's origin. */
  y: number;
  /** The width of the DOMRect. */
  width: number;
  /** The height of the DOMRect. */
  height: number;
  /**
   * The top coordinate value of the DOMRect
   * (has the same value as y, or y + height if height is negative.)
   */
  top: number;
  /**
   * The right coordinate value of the DOMRect
   * (has the same value as x + width, or x if width is negative.)
   */
  right: number;
  /**
   * The bottom coordinate value of the DOMRect
   * (has the same value as y + height, or y if height is negative.)
   */
  bottom: number;
  /**
   * The left coordinate value of the DOMRect
   * (has the same value as x, or x + width if width is negative.)
   */
  left: number;
  /**
   * The DOMRect width as a percentage of the viewport width
   * (where 0 is 0% and 1 is 100%.)
   */
  vw: number;
  /**
   * The DOMRect height as a percentage of the viewport height
   * (where 0 is 0% and 1 is 100%.)
   */
  vh: number;
}
```

[hook]: https://reactjs.org/docs/hooks-overview.html
[ref]: https://reactjs.org/docs/refs-and-the-dom.html
[useref]: https://reactjs.org/docs/hooks-reference.html#useref
[ref object]: https://reactjs.org/docs/refs-and-the-dom.html#accessing-refs
[forward a ref]: https://reactjs.org/docs/forwarding-refs.html
[domrect]: https://developer.mozilla.org/en-US/docs/Web/API/DOMRect
[shared ref / ref forwarding]: #shared-ref--ref-forwarding
[stateful]: #stateful
[stateless]: #stateless
[size]: #size
[handler]: #handler
